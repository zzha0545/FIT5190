# 使用列联表和卡方分布检验特征重要性分析

## 理论基础

### 列联表 (Contingency Table)
列联表是一种用于分析两个分类变量之间关系的表格形式。在我们的特征重要性分析中，我们将建立以下列联表：
- 行：特征的分箱值（例如，身高被分为高、中、低）
- 列：预测误差的级别（高误差 vs 低误差）

通过这种方式，我们可以观察特征值与预测准确性之间是否存在关联。

### 卡方检验 (Chi-squared Test)
卡方检验是一种统计方法，用于确定两个分类变量之间是否存在显著关联。在特征重要性分析中，我们使用卡方检验来评估特征与预测误差之间的关联程度。

卡方检验的基本步骤：
1. 建立虚无假设(H0)：特征与预测误差之间没有关联
2. 建立备择假设(H1)：特征与预测误差之间存在关联
3. 计算卡方统计量和p值
4. 如果p值小于显著性水平α（通常为0.05），则拒绝虚无假设，认为特征与预测误差存在显著关联

## 实现方法

我们的方法包括以下几个主要步骤：

### 1. 数据准备
- 加载训练数据（包含身高、体重和性别）
- 预处理数据（处理缺失值、特征编码）
- 分割训练集和测试集

### 2. 模型训练与预测
- 训练线性回归模型（使用身高和性别作为特征，预测体重）
- 在测试集上进行预测
- 计算每个样本的预测误差（实际值与预测值之间的绝对差）

### 3. 基于列联表的特征重要性分析
- 对连续特征（如身高）进行分箱处理，将其转换为分类变量
- 对预测误差进行二分类（高误差 vs 低误差，以误差中位数为界）
- 创建列联表，观察特征分箱与误差级别之间的关系
- 进行卡方独立性检验，评估特征与预测误差之间的关联是否显著

### 4. 模型比较
- 训练包含特定特征的完整模型
- 训练不包含该特征的简化模型
- 比较两个模型的预测性能（通过MAE指标）
- 计算特征对模型性能的影响百分比

### 5. 可视化
- 根据特征分箱绘制预测误差图
- 分析特征值与预测误差之间的关系趋势

## 分析流程示例

以下是使用`feature_significance_test.py`进行特征重要性分析的流程示例：

1. **分析身高特征的重要性**：
   - 将身高分为3个区间（低、中、高）
   - 将预测误差分为高误差和低误差两类
   - 创建列联表并进行卡方检验
   - 根据p值判断身高特征对预测准确性的影响是否显著

2. **分析性别特征的重要性**：
   - 性别本身已经是分类变量（M/F）
   - 同样创建列联表并进行卡方检验
   - 判断性别特征的重要性

3. **比较包含/不包含特征的模型性能**：
   - 计算完整模型（包含身高和性别）的MAE
   - 计算去除特定特征后模型的MAE
   - 对比两个模型的性能差异

## 解释结果的方法

卡方检验结果的解释：
- **p值 < 0.05**：有足够证据表明特征与预测误差之间存在显著关联，说明该特征对预测准确性有重要影响
- **p值 ≥ 0.05**：没有足够证据表明特征与预测误差之间存在显著关联，说明该特征可能对预测准确性没有重要影响

模型比较结果的解释：
- 如果去除特征后MAE显著增加，表明该特征对预测准确性有正面影响
- 如果去除特征后MAE变化不大或减小，表明该特征对预测准确性影响有限或甚至有负面影响

## 在体重预测项目中的应用

在体重预测项目中，我们可以分析身高和性别这两个特征对预测准确性的影响：
1. 身高与体重有自然的正相关关系，预期会对预测准确性有显著影响
2. 性别与体重也有关联（一般情况下，男性平均体重高于女性），但其影响程度可能需要通过实验验证

## 总结和建议

通过列联表和卡方检验的方法，我们可以：
1. 定量评估特征对预测准确性的影响
2. 识别对预测最重要的特征
3. 为模型简化和特征选择提供依据
4. 深入理解特征与目标变量之间的关系

根据分析结果，我们可以决定是否保留或移除特定特征，从而优化模型性能和复杂度。 